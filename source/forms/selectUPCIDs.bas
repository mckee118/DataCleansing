Version =20
VersionRequired =20
PublishOption =1
    Modal = NotDefault
    RecordSelectors = NotDefault
    NavigationButtons = NotDefault
    DividingLines = NotDefault
    AllowDesignChanges = NotDefault
    DefaultView =0
    ScrollBars =0
    PictureAlignment =2
    DatasheetGridlinesBehavior =3
    GridY =10
    Width =18769
    DatasheetFontHeight =11
    ItemSuffix =22
    Top =195
    Right =8250
    Bottom =8655
    DatasheetGridlinesColor =14806254
        0xa9f965aa9b59e440
    End
    Caption ="Selecting Options"
    OnOpen ="[Event Procedure]"
    DatasheetFontName ="Calibri"
        0x6801000068010000680100006801000000000000201c0000e010000001000000 ,
        0x010000006801000000000000a10700000100000001000000
    End
    AllowDatasheetView =0
    AllowPivotTableView =0
    AllowPivotChartView =0
    AllowPivotChartView =0
    FilterOnLoad =0
    ShowPageMargins =0
    DisplayOnSharePointSite =1
    DatasheetAlternateBackColor =15921906
    DatasheetGridlinesColor12 =0
    FitToScreen =1
    DatasheetBackThemeColorIndex =1
    BorderThemeColorIndex =3
    ThemeFontIndex =1
    ForeThemeColorIndex =0
    AlternateBackThemeColorIndex =1
    AlternateBackShade =95.0
            BackStyle =0
            FontSize =11
            FontName ="Calibri"
            ThemeFontIndex =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =0
            BorderTint =50.0
            ForeThemeColorIndex =0
            ForeTint =50.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
            BackStyle =0
            OldBorderStyle =0
            BorderLineStyle =0
            SizeMode =3
            PictureAlignment =2
            Width =1701
            Height =1701
            BorderColor =16777215
            GridlineColor =16777215
            BackThemeColorIndex =1
            BorderThemeColorIndex =1
            BorderShade =65.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
            Width =1701
            Height =283
            FontSize =11
            FontWeight =400
            FontName ="Calibri"
            ForeThemeColorIndex =0
            ForeTint =75.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
            UseTheme =1
            Shape =1
            Gradient =12
            BackThemeColorIndex =4
            BackTint =60.0
            BorderLineStyle =0
            BorderColor =16777215
            BorderThemeColorIndex =4
            BorderTint =60.0
            ThemeFontIndex =1
            HoverThemeColorIndex =4
            HoverTint =40.0
            PressedThemeColorIndex =4
            PressedShade =75.0
            HoverForeThemeColorIndex =0
            HoverForeTint =75.0
            PressedForeThemeColorIndex =0
            PressedForeTint =75.0
        End
            BorderLineStyle =0
            LabelX =230
            LabelY =-30
            BorderThemeColorIndex =1
            BorderShade =65.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
            AddColon = NotDefault
            FELineBreak = NotDefault
            BorderLineStyle =0
            Width =1701
            LabelX =-1701
            FontSize =11
            FontName ="Calibri"
            AsianLineBreak =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =1
            BorderShade =65.0
            ThemeFontIndex =1
            ForeThemeColorIndex =0
            ForeTint =75.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
            BorderLineStyle =0
            Width =1701
            Height =1417
            LabelX =-1701
            FontSize =11
            FontName ="Calibri"
            AllowValueListEdits =1
            InheritValueList =1
            ThemeFontIndex =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =1
            BorderShade =65.0
            ForeThemeColorIndex =0
            ForeTint =75.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
            SpecialEffect =2
            OldBorderStyle =1
            Width =4536
            Height =2835
            ThemeFontIndex =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =1
            BorderShade =65.0
            ForeThemeColorIndex =2
            ForeShade =50.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
            Height =9977
            BackColor =15590879
            Name ="Detail"
            AlternateBackColor =15921906
            AlternateBackThemeColorIndex =1
            AlternateBackShade =95.0
                    RowSourceTypeInt =1
                    OverlapFlags =87
                    IMESentenceMode =3
                    Left =6585
                    Top =3855
                    Width =3005
                    Height =5160
                    FontSize =14
                    BackColor =9592887
                    ForeColor =16777215
                    BorderColor =10921638
                    Name ="List0"
                    RowSourceType ="Value List"
                    RowSource ="UPCID_N_NP, UPCID_WS_WP, UPCID_WS_NP, UPCID_CS_WP, UPCID_CS_NP, UPCID_N_NVD_WP, "
                        "UPCID_N_NVD_NP, UPCID_NVD_WP, UPCID_NVD_NP, UPCID_N_FC_WP, UPCID_N_FC_NP, UPCID_"
                        "N_3C_WP, UPCID_N_3C_NP"
                    OnClick ="[Event Procedure]"
                    ControlTipText ="UPCID_WS_WP = Whole street address including numbers + whole postcode"
                    GridlineColor =10921638
                    AllowValueListEdits =0

                    LayoutCachedLeft =6585
                    LayoutCachedTop =3855
                    LayoutCachedWidth =9590
                    LayoutCachedHeight =9015
                    BackThemeColorIndex =4
                    BackShade =75.0
                    ForeThemeColorIndex =-1
                    ForeTint =100.0
                End
                    RowSourceTypeInt =1
                    OverlapFlags =87
                    IMESentenceMode =3
                    Left =11505
                    Top =3855
                    Width =3005
                    Height =5160
                    FontSize =14
                    TabIndex =1
                    BackColor =9592887
                    ForeColor =16777215
                    BorderColor =10921638
                    Name ="List2"
                    RowSourceType ="Value List"
                    RowSource ="UPCID_N_WP"
                    OnClick ="[Event Procedure]"
                    GridlineColor =10921638
                    AllowValueListEdits =0

                    LayoutCachedLeft =11505
                    LayoutCachedTop =3855
                    LayoutCachedWidth =14510
                    LayoutCachedHeight =9015
                    BackThemeColorIndex =4
                    BackShade =75.0
                    ForeThemeColorIndex =-1
                    ForeTint =100.0
                End
                    OverlapFlags =85
                    Left =9810
                    Top =4755
                    Width =1482
                    Height =510
                    FontSize =16
                    FontWeight =700
                    TabIndex =2
                    ForeColor =6373413
                    Name ="Command4"
                    Caption ="Add +"
                    OnClick ="[Event Procedure]"
                    GridlineColor =10921638

                    LayoutCachedLeft =9810
                    LayoutCachedTop =4755
                    LayoutCachedWidth =11292
                    LayoutCachedHeight =5265
                    ForeThemeColorIndex =4
                    ForeTint =100.0
                    ForeShade =50.0
                    Gradient =0
                    BackColor =14136213
                    BorderColor =14136213
                    HoverColor =16051931
                    HoverThemeColorIndex =8
                    HoverTint =20.0
                    PressedColor =9592887
                    HoverForeColor =6373413
                    HoverForeThemeColorIndex =4
                    HoverForeTint =100.0
                    HoverForeShade =50.0
                    PressedForeColor =4210752
                    WebImagePaddingLeft =2
                    WebImagePaddingTop =2
                    WebImagePaddingRight =1
                    WebImagePaddingBottom =1
                    Overlaps =1
                End
                    OverlapFlags =85
                    Left =9810
                    Top =7650
                    Width =1482
                    Height =510
                    FontSize =16
                    FontWeight =700
                    TabIndex =3
                    ForeColor =6373413
                    Name ="Command5"
                    Caption ="Remove -"
                    OnClick ="[Event Procedure]"
                    GridlineColor =10921638

                    LayoutCachedLeft =9810
                    LayoutCachedTop =7650
                    LayoutCachedWidth =11292
                    LayoutCachedHeight =8160
                    ForeThemeColorIndex =4
                    ForeTint =100.0
                    ForeShade =50.0
                    Gradient =0
                    BackColor =14136213
                    BorderColor =14136213
                    HoverColor =16051931
                    HoverThemeColorIndex =8
                    HoverTint =20.0
                    PressedColor =9592887
                    HoverForeColor =6373413
                    HoverForeThemeColorIndex =4
                    HoverForeTint =100.0
                    HoverForeShade =50.0
                    PressedForeColor =4210752
                    WebImagePaddingLeft =2
                    WebImagePaddingTop =2
                    WebImagePaddingRight =1
                    WebImagePaddingBottom =1
                    Overlaps =1
                End
                    OverlapFlags =85
                    Left =16384
                    Top =6859
                    Width =1927
                    Height =511
                    FontSize =16
                    FontWeight =700
                    TabIndex =4
                    ForeColor =6373413
                    Name ="Command6"
                    Caption ="Next >>"
                    OnClick ="[Event Procedure]"
                    GridlineColor =10921638

                    LayoutCachedLeft =16384
                    LayoutCachedTop =6859
                    LayoutCachedWidth =18311
                    LayoutCachedHeight =7370
                    ForeThemeColorIndex =4
                    ForeTint =100.0
                    ForeShade =50.0
                    Gradient =0
                    BackColor =14136213
                    BorderColor =14136213
                    HoverColor =16051931
                    HoverThemeColorIndex =8
                    HoverTint =20.0
                    PressedColor =9592887
                    HoverForeColor =6373413
                    HoverForeThemeColorIndex =4
                    HoverForeTint =100.0
                    HoverForeShade =50.0
                    PressedForeColor =4210752
                    WebImagePaddingLeft =2
                    WebImagePaddingTop =2
                    WebImagePaddingRight =1
                    WebImagePaddingBottom =1
                    Overlaps =1
                End
                    Visible = NotDefault
                    OverlapFlags =85
                    IMESentenceMode =3
                    Top =8392
                    Height =315
                    TabIndex =5
                    BorderColor =10921638
                    ForeColor =4210752
                    Name ="Text7"
                    GridlineColor =10921638

                    LayoutCachedTop =8392
                    LayoutCachedWidth =1701
                    LayoutCachedHeight =8707
                End
                    OldBorderStyle =0
                    OverlapFlags =93
                    TextAlign =2
                    BackStyle =0
                    IMESentenceMode =3
                    Left =6585
                    Top =3120
                    Width =7887
                    Height =735
                    FontSize =14
                    FontWeight =600
                    TabIndex =6
                    BorderColor =10921638
                    ForeColor =12349952
                    Name ="Text11"
                    GridlineColor =10921638

                    LayoutCachedLeft =6585
                    LayoutCachedTop =3120
                    LayoutCachedWidth =14472
                    LayoutCachedHeight =3855
                    ForeThemeColorIndex =-1
                    ForeTint =100.0
                End
                    PictureType =2
                    Left =8445
                    Width =4350
                    Height =2250
                    BorderColor =10921638
                    Name ="Image3"
                    Picture ="Logo_transparent"
                    GridlineColor =10921638

                    LayoutCachedLeft =8445
                    LayoutCachedWidth =12795
                    LayoutCachedHeight =2250
                    TabIndex =8
                End
                    Visible = NotDefault
                    OverlapFlags =85
                    Left =10590
                    Top =9255
                    TabIndex =7
                    BorderColor =14136213
                    Name ="Check15"
                    GridlineColor =10921638

                    LayoutCachedLeft =10590
                    LayoutCachedTop =9255
                    LayoutCachedWidth =10850
                    LayoutCachedHeight =9495
                    BorderThemeColorIndex =4
                    BorderTint =60.0
                    BorderShade =100.0
                            Visible = NotDefault
                            OverlapFlags =85
                            Left =10924
                            Top =9195
                            Width =3570
                            Height =405
                            FontSize =16
                            FontWeight =700
                            BorderColor =8355711
                            ForeColor =12349952
                            Name ="Label16"
                            Caption ="Update Pointer MatchKeys"
                            GridlineColor =10921638
                            LayoutCachedLeft =10924
                            LayoutCachedTop =9195
                            LayoutCachedWidth =14494
                            LayoutCachedHeight =9600
                            ForeThemeColorIndex =-1
                            ForeTint =100.0
                        End
                    End
                End
                    PictureType =2
                    Left =10091
                    Top =6015
                    Width =915
                    Height =855
                    BorderColor =10921638
                    Name ="Image5"
                    OnClick ="[Event Procedure]"
                    ControlTipText ="Click for information"
                    Picture ="informationButton"
                    GridlineColor =10921638

                    LayoutCachedLeft =10091
                    LayoutCachedTop =6015
                    LayoutCachedWidth =11006
                    LayoutCachedHeight =6870
                    TabIndex =9
                End
                    PictureType =2
                    Left =7530
                    Top =2490
                    Width =5865
                    Height =615
                    BorderColor =10921638
                    Name ="Image17"
                    Picture ="dots"
                    GridlineColor =10921638

                    LayoutCachedLeft =7530
                    LayoutCachedTop =2490
                    LayoutCachedWidth =13395
                    LayoutCachedHeight =3105
                    TabIndex =10
                End
                    Visible = NotDefault
                    PictureType =2
                    Left =8775
                    Top =2520
                    Width =375
                    Height =480
                    BorderColor =10921638
                    Name ="step1"
                    Picture ="dotSelected"
                    GridlineColor =10921638

                    LayoutCachedLeft =8775
                    LayoutCachedTop =2520
                    LayoutCachedWidth =9150
                    LayoutCachedHeight =3000
                    TabIndex =11
                End
                    Visible = NotDefault
                    PictureType =2
                    Left =10200
                    Top =2520
                    Width =375
                    Height =480
                    BorderColor =10921638
                    Name ="step2"
                    Picture ="dotSelected"
                    GridlineColor =10921638

                    LayoutCachedLeft =10200
                    LayoutCachedTop =2520
                    LayoutCachedWidth =10575
                    LayoutCachedHeight =3000
                    TabIndex =12
                End
                    Visible = NotDefault
                    PictureType =2
                    Left =11625
                    Top =2505
                    Width =375
                    Height =480
                    BorderColor =10921638
                    Name ="step3"
                    Picture ="dotSelected"
                    GridlineColor =10921638

                    LayoutCachedLeft =11625
                    LayoutCachedTop =2505
                    LayoutCachedWidth =12000
                    LayoutCachedHeight =2985
                    TabIndex =13
                End
            End
        End
    End
End
CodeBehindForm
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Compare Database
Public UPCIDsExisting As String
Public UPCIDs As String
Public strTable As String
Public statusmsg As Variant

Private Sub Command4_Click()

For i = 0 To List0.listCount - 1
    If List0.Selected(i) Then
        List2.AddItem List0.Column(0)
        List0.RemoveItem List0.Column(0)
    End If
Next i

Me.List0.Selected(0) = True

statusmsg = SysCmd(acSysCmdSetStatus, "Add or remove more UPCIDs or click Next to continue")

End Sub

Private Sub Command5_Click()

For i = 0 To List2.listCount - 1
    If List2.Selected(i) Then
        List0.AddItem List2.Column(0)
        List2.RemoveItem List2.Column(0)
    End If
Next i

Me.List2.Selected(0) = True

statusmsg = SysCmd(acSysCmdSetStatus, "Add or remove more UPCIDs or click Next to continue")

End Sub

Private Sub Command6_Click()

Dim strSQL As String
Dim UPCIDsSplit() As String
Dim ListBoxUPCIDs() As String
Dim UnwantedListBoxUPCIDs() As String
Dim hasUPRN As String
Dim queryLength As Single
Dim queryLengthMin As Single
Dim length As Single
Dim listCount As Integer

On Error GoTo ErrorHandler:

UPCIDsSplit() = Split(UPCIDsExisting, ", ")

ListBoxUPCIDs() = Split(Replace(List2.RowSource, ";", ", "), ", ")

UnwantedListBoxUPCIDs() = Split(Replace(List0.RowSource, ";", ", "), ", ")

strSQL = "SELECT COLUMN_NAME FROM [INFORMATION_SCHEMA].COLUMNS WHERE COLUMN_NAME = 'uprn' AND TABLE_NAME = '" & strTable & "'"

ChangePTStatement "getUPRNColumn", strSQL

strSQL = ""

hasUPRN = Nz(DLookup("COLUMN_NAME", "getUPRNColumn"), "none")

Dim i As Long
Dim j As Long
Dim wanted As String
Dim unwanted As String

unwanted = ""

listCount = Me.List2.listCount

If Check15.Value = True Then
   queryLength = Nz(DLookup("queryLength", "queryTime", "queryType = '" & Text7.Value & listCount & "' and queryTable = '" & strTable & "'")) + Nz(DLookup("queryLength", "queryTime", "queryType = 'pointer'"))
Else
   queryLength = Nz(DLookup("queryLength", "queryTime", "queryType = '" & Text7.Value & listCount & "' and queryTable = '" & strTable & "'"))
End If

If queryLength > 60 Then
   queryLengthMin = Fix(queryLength / 60)
   queryLength = Round(queryLength - (queryLengthMin * 60), 0)
Else
   queryLengthMin = 0
End If

If queryLength = 0 Then
   DoCmd.OpenForm "frmCustomMSG", , , , , , "This query has not been run before and may take some time, Please wait..."
Else
   DoCmd.OpenForm "frmCustomMSG", , , , , , "Estimated time: " & queryLengthMin & " minutes and " & queryLength & " seconds, Please wait..."
End If

Pause (1)
       
If Text7.Value = "create" Then
       
    For i = LBound(ListBoxUPCIDs) To UBound(ListBoxUPCIDs)
        For j = LBound(UPCIDsSplit) To UBound(UPCIDsSplit)
            If ListBoxUPCIDs(i) = UPCIDsSplit(j) Then
                ListBoxUPCIDs(i) = "@"
            End If
        Next j
    Next i

    For i = LBound(UnwantedListBoxUPCIDs) To UBound(UnwantedListBoxUPCIDs)
        For j = LBound(UPCIDsSplit) To UBound(UPCIDsSplit)
            If UnwantedListBoxUPCIDs(i) = UPCIDsSplit(j) Then
               unwanted = unwanted & UnwantedListBoxUPCIDs(i) & ", "
            End If
        Next j
    Next i
    

    wanted = Join(ListBoxUPCIDs, ", ")
    
    wanted = Replace(wanted, "@, ", "")
    
    wanted = Replace(wanted, "@", "")
    
    starttime = Timer
    
    If unwanted <> "" Then
        unwanted = Left(unwanted, Len(unwanted) - 2)
        strSQL = "ALTER TABLE "
        strSQL = strSQL & strTable
        strSQL = strSQL & " DROP COLUMN " & unwanted
             
        ChangePTStatement "deleteUPCIDsAddress", strSQL
       
        DoCmd.SetWarnings (False)
        DoCmd.OpenQuery ("deleteUPCIDsAddress")
        MsgBox "UPCID(s) Deleted.", vbOKOnly, "Complete!"
        DoCmd.SetWarnings (True)
    End If

    List2.RowSource = ""

    Dim sqlUPCIDs As String
    sqlUPCIDs = Replace(wanted, ", ", " varchar(128), ")
    If wanted <> "" Then
         sqlUPCIDs = sqlUPCIDs & " varchar(128)"
    End If
       
    If wanted <> "" Then
       If hasUPRN = "none" Then
          strSQL = "ALTER TABLE "
          strSQL = strSQL & strTable
          strSQL = strSQL & " ADD " & sqlUPCIDs & ", UPRN varchar(128)"
             
          ChangePTStatement "createUPCIDsAddress", strSQL
       
          DoCmd.SetWarnings (False)
          DoCmd.OpenQuery ("createUPCIDsAddress")
          MsgBox "UPCID(s) Created and UPRN column also added.", vbOKOnly, "Complete!"
          DoCmd.SetWarnings (True)
       Else
          strSQL = "ALTER TABLE "
          strSQL = strSQL & strTable
          strSQL = strSQL & " ADD " & sqlUPCIDs
          
          ChangePTStatement "createUPCIDsAddress", strSQL
       
          DoCmd.SetWarnings (False)
          DoCmd.OpenQuery ("createUPCIDsAddress")
          MsgBox "UPCID(s) Created", vbOKOnly, "Complete!"
          DoCmd.SetWarnings (True)
                          
       End If
              
    End If
    
    length = Fix(Format(Timer - starttime, "fixed")) + 1
    
    DoCmd.SetWarnings (False)
    
    If queryLength = 0 Then
       strSQL = "INSERT INTO queryTime VALUES ('" & Text7.Value & listCount & "', '" & strTable & "', " & length & ")"
       DoCmd.RunSQL strSQL
    Else
       strSQL = "UPDATE queryTime SET [queryLength] = " & length & " WHERE queryType = '" & Text7.Value & listCount & "' and queryTable = '" & strTable & "'"
       DoCmd.RunSQL strSQL
    End If
    
    DoCmd.SetWarnings (True)
    
    DoCmd.Close acForm, "frmCustomMSG", acSaveNo
    
    Dim strSQLDefault As String
    
    strSQL = "SELECT COLUMN_NAME"
    strSQL = strSQL & " FROM [INFORMATION_SCHEMA].COLUMNS"
    strSQL = strSQL & " WHERE COLUMN_NAME LIKE 'upcid%' AND TABLE_NAME = " & "'" & strTable & "'"
       
    'call the pass through function
    ChangePTStatement "getUPCIDColumns", strSQL
    
    DoCmd.Close
    DoCmd.OpenForm "selectUPCIDs", , , , , , strTable
    
    statusmsg = SysCmd(acSysCmdSetStatus, "Please select from the UPCIDs that you wish to populate. If Pointer needs updated then don't forget to check the relevant box. Click the 'i' for more information.")
    
    Forms!selectUPCIDs!Text7.Value = "add"
       
    Forms!selectUPCIDs!Text11.Value = "Select UPCID Columns to populate in the table " & strTable
            
    Forms!selectUPCIDs!List0.RowSource = Forms!selectUPCIDs!List2.RowSource
    Forms!selectUPCIDs!List2.RowSource = ""
    
    Forms!selectUPCIDs!step2.Visible = True
    
    If DLookup("date", "pointer_update") < (Date - 30) Then
        Forms!selectUPCIDs!Check15.Visible = True
        Forms!selectUPCIDs!Label16.Visible = True
        Forms!selectUPCIDs!Check15.Value = False
    Else
        Forms!selectUPCIDs!Check15.Visible = True
        Forms!selectUPCIDs!Label16.Visible = True
        Forms!selectUPCIDs!Check15.Value = False
        Forms!selectUPCIDs!Check15.Enabled = False
    End If
ElseIf Text7.Value = "add" Then

       Dim caseStates() As String
       Dim forSQL As String
       caseStates = Split(Replace(List2.RowSource, ";", ", "), ", ")
       
       forSQL = Replace(List2.RowSource, ";", ", ")
       
       Dim sqlDefault As String
       Dim sqlstr As String
            
       sqlDefault = "Update " & strTable & " set"
       sqlstr = ""
       
       For i = LBound(caseStates) To UBound(caseStates)
            Select Case caseStates(i)
            
            Case "UPCID_N_WP"
                sqlstr = sqlstr & sqlDefault & " upcid_n_wp = REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'numbers') + ISNULL(POSTCODE, ''), ' ', '')"
            Case "UPCID_N_NP"
                sqlstr = sqlstr & sqlDefault & " upcid_n_np = REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, '')+ISNULL(POSTCODE, ''), 'numbers'), ' ', '')"
            Case "UPCID_WS_WP"
                sqlstr = sqlstr & sqlDefault & " upcid_ws_wp = dbo.unwanted(REPLACE(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, '')+ISNULL(POSTCODE, ''), ' ', ''))"
            Case "UPCID_WS_NP"
                sqlstr = sqlstr & sqlDefault & " upcid_ws_np = dbo.unwanted(REPLACE(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, '')+DBO.fn_extract_chars(ISNULL(POSTCODE, ''), 'numbers'), ' ', ''))"
            Case "UPCID_CS_WP"
                sqlstr = sqlstr & sqlDefault & " upcid_cs_wp = dbo.unwanted(REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'letters') + ISNULL(POSTCODE, ''), ' ', ''))"
            Case "UPCID_CS_NP"
                sqlstr = sqlstr & sqlDefault & " upcid_cs_np = dbo.unwanted(REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'letters')+DBO.fn_extract_chars(ISNULL(POSTCODE, ''), 'numbers'), ' ', ''))"
            Case "UPCID_N_NVD_WP"
                sqlstr = sqlstr & sqlDefault & " upcid_n_nvd_wp = dbo.unwanted(REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'numbers')+DBO.nvd(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, '')) +ISNULL(POSTCODE, ''), ' ', ''))"
            Case "UPCID_N_NVD_NP"
                sqlstr = sqlstr & sqlDefault & " upcid_n_nvd_np = dbo.unwanted(REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'numbers')+DBO.nvd(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, '')) +DBO.fn_extract_chars(ISNULL(POSTCODE, ''), 'numbers'), ' ', ''))"
            Case "UPCID_NVD_WP"
                sqlstr = sqlstr & sqlDefault & " upcid_nvd_wp = dbo.unwanted(REPLACE(DBO.nvd(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, '')) +ISNULL(POSTCODE, ''), ' ', ''))"
            Case "UPCID_NVD_NP"
                sqlstr = sqlstr & sqlDefault & " upcid_nvd_np = dbo.unwanted(REPLACE(DBO.nvd(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, '')) + DBO.fn_extract_chars(ISNULL(POSTCODE, ''), 'numbers'), ' ', ''))"
            Case "UPCID_N_FC_WP"
                sqlstr = sqlstr & sqlDefault & " upcid_n_fc_wp = dbo.unwanted(REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'numbers')+LEFT(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'letters'), 1)+ISNULL(POSTCODE, ''), ' ', ''))"
            Case "UPCID_N_FC_NP"
                sqlstr = sqlstr & sqlDefault & " upcid_n_fc_np = dbo.unwanted(REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'numbers')+LEFT(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'letters'), 1)+DBO.fn_extract_chars(ISNULL(POSTCODE, ''), 'numbers'), ' ', ''))"
            Case "UPCID_N_3C_WP"
                sqlstr = sqlstr & sqlDefault & " upcid_n_3c_wp = dbo.unwanted(REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'numbers')+LEFT(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'letters'), 3)+ISNULL(POSTCODE, ''), ' ', ''))"
            Case "UPCID_N_3C_NP"
                sqlstr = sqlstr & sqlDefault & " upcid_n_3c_np = dbo.unwanted(REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'numbers')+LEFT(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'letters'), 3)+DBO.fn_extract_chars(ISNULL(POSTCODE, ''), 'numbers'), ' ', ''))"
            End Select
       Next i
              
       strSQL = sqlstr
             
       'call the pass through function
       ChangePTStatement "addUPCIDsAddress", strSQL
       
       If IsNull(DLookup("table", "UPCIDs", "table = '" & strTable & "'")) = True Then
          strSQL = "INSERT INTO UPCIDs ([table], UPCIDs) VALUES ('" & strTable & "', '" & forSQL & "')"
          DoCmd.SetWarnings (False)
          DoCmd.RunSQL strSQL
          DoCmd.SetWarnings (True)
       Else
          DoCmd.SetWarnings (False)
          strSQL = "DELETE FROM UPCIDs WHERE [table] = '" & strTable & "'"
          DoCmd.RunSQL strSQL
          strSQL = "INSERT INTO UPCIDs ([table], UPCIDs) VALUES ('" & strTable & "', '" & forSQL & "')"
          DoCmd.RunSQL strSQL
          DoCmd.SetWarnings (True)
       End If
       
       Dim pointerLength As Single
       
       If Me.Check15.Value = True Then
          If DLookup("counter", "getPointerUPCIDs") <= 0 Then
             DoCmd.SetWarnings (False)
             starttime = Timer
             DoCmd.OpenQuery ("createUPCIDsPOINTER")
             DoCmd.OpenQuery ("addUPCIDsPOINTER")
             pointerLength = Fix(Format(Timer - starttime, "fixed")) + 1
             strSQL = "UPDATE pointer_update SET [date] = '" & Date & "' WHERE ID = 1"
             DoCmd.RunSQL strSQL
             DoCmd.SetWarnings (True)
          Else
             If MsgBox("Are you sure you want to update Pointer UPCIDs?", vbYesNo, "Continue?") = vbYes Then
                DoCmd.SetWarnings (False)
                starttime = Timer
                DoCmd.OpenQuery ("addUPCIDsPOINTER")
                pointerLength = Fix(Format(Timer - starttime, "fixed")) + 1
                strSQL = "UPDATE pointer_update SET [date] = '" & Date & "' WHERE ID = 1"
                DoCmd.RunSQL strSQL
                DoCmd.SetWarnings (True)
             End If
          End If
        End If
        
        starttime = Timer
        
        DoCmd.SetWarnings (False)
        DoCmd.OpenQuery ("addUPCIDsAddress")
        MsgBox "UPCIDs Added", vbOKOnly, "Complete"
        DoCmd.SetWarnings (True)
                
        length = Fix(Format(Timer - starttime, "fixed")) + 1
                
        DoCmd.SetWarnings (False)
        If Check15.Value = True Then
            If queryLength = 0 Then
               strSQL = "INSERT INTO queryTime VALUES ('" & Text7.Value & listCount & "', '" & strTable & "', " & length & ")"
               DoCmd.RunSQL strSQL
               strSQL = "INSERT INTO queryTime VALUES ('pointer', 'pointer', " & pointerLength & ")"
               DoCmd.RunSQL strSQL
            Else
               strSQL = "UPDATE queryTime SET [queryLength] = " & length & " WHERE queryType = '" & Text7.Value & listCount & "' and queryTable = '" & strTable & "'"
               DoCmd.RunSQL strSQL
               strSQL = "UPDATE queryTime SET [queryLength] = " & pointerLength & " WHERE queryType = 'pointer' and queryTable = 'pointer'"
               DoCmd.RunSQL strSQL
            End If
        Else
            If queryLength = 0 Then
               strSQL = "INSERT INTO queryTime VALUES ('" & Text7.Value & listCount & "', '" & strTable & "', " & length & ")"
               DoCmd.RunSQL strSQL
            Else
               strSQL = "UPDATE queryTime SET [queryLength] = " & length & " WHERE queryType = '" & Text7.Value & listCount & "' and queryTable = '" & strTable & "'"
               DoCmd.RunSQL strSQL
            End If
        End If
        DoCmd.SetWarnings (True)
        
        DoCmd.Close acForm, "frmCustomMSG", acSaveNo
        
        strSQL = "SELECT COLUMN_NAME"
        strSQL = strSQL & " FROM [INFORMATION_SCHEMA].COLUMNS"
        strSQL = strSQL & " WHERE COLUMN_NAME LIKE 'upcid%' AND TABLE_NAME = " & "'" & strTable & "'"
       
        'call the pass through function
        ChangePTStatement "getUPCIDColumns", strSQL
    
        DoCmd.Close
        DoCmd.OpenForm "selectUPCIDs", , , , , , strTable

        Forms!selectUPCIDs!Text7.Value = "match"
       
        statusmsg = SysCmd(acSysCmdSetStatus, "Please order the UPCIDs in the order you wish them to be matched. Click the 'i' for more information.")
       
        Forms!selectUPCIDs!Text11.Value = "Select UPCID Columns from table " & strTable & " you wish to match on"
       
        If IsNull(DLookup("[table]", "UPCIDs", "[table] = '" & strTable & "'")) = False Then
           Forms!selectUPCIDs!List0.RowSource = DLookup("UPCIDs", "UPCIDs", "[Table] = '" & strTable & "'")
        Else
           Forms!selectUPCIDs!List0.RowSource = ""
        End If
        
        Forms!selectUPCIDs!List2.RowSource = ""
        
        Forms!selectUPCIDs!Check15.Visible = False
        Forms!selectUPCIDs!Label16.Visible = False
        
        Forms!selectUPCIDs!step3.Visible = True
        
ElseIf Text7.Value = "match" Then
    
    caseStates = Split(Replace(List2.RowSource, ";", ", "), ", ")
                
    sqlstr = ""
    
    For i = LBound(caseStates) To UBound(caseStates)
    
            sqlstr = sqlstr & "select a." & caseStates(i) & " as add" & caseStates(i) & ", p." & caseStates(i) & " as P" & caseStates(i) & ", p.UPRN" & _
            " into tempPointer" & _
            " from " & strTable & " a" & _
            " inner join POINTER p" & _
            " on a." & caseStates(i) & " = p." & caseStates(i) & _
            vbNewLine & _
            "select add" & caseStates(i) & ", COUNT(*) as counter" & _
            " into tempAddress" & _
            " from tempPointer" & _
            " group by add" & caseStates(i) & _
            " having COUNT(*) >= 1" & _
            vbNewLine & _
            "Update main" & _
            " Set main.uprn = tp.uprn" & _
            " from " & strTable & " main" & _
            " inner join tempPointer tp" & _
            " on main." & caseStates(i) & " = tp.P" & caseStates(i) & _
            " inner join tempAddress ta" & _
            " on main." & caseStates(i) & " = ta.add" & caseStates(i) & _
            " where main.uprn Is Null and len(" & caseStates(i) & ") > 1" & _
            vbNewLine & _
            "drop table tempPointer" & _
            vbNewLine & _
            "drop table tempAddress" & _
            vbNewLine
            
       Next i
       
       strSQL = sqlstr
             
       'call the pass through function
       ChangePTStatement "addUPRN", strSQL
       
       strSQL = "SELECT COUNT(*) AS col FROM " & strTable & " WHERE uprn IS NULL"
       
       ChangePTStatement "countUPRN", strSQL
              
        starttime = Timer
       
        statusmsg = SysCmd(acSysCmdSetStatus, "Matching process has begun, Please Wait...")
       
        Dim uprnCount As Integer
       
        DoCmd.SetWarnings (False)
        uprnCount = DLookup("col", "countUPRN")
        DoCmd.OpenQuery ("addUPRN")
        MsgBox "UPRNs Added", vbOKOnly, "Complete"
        DoCmd.SetWarnings (True)
        
        length = Fix(Format(Timer - starttime, "fixed")) + 1

        DoCmd.SetWarnings (False)
        
        If queryLength = 0 Then
           strSQL = "INSERT INTO queryTime VALUES ('" & Text7.Value & listCount & "', '" & strTable & "', " & length & ")"
           DoCmd.RunSQL strSQL
        Else
           strSQL = "UPDATE queryTime SET [queryLength] = " & length & " WHERE queryType = '" & Text7.Value & listCount & "' and queryTable = '" & strTable & "'"
           DoCmd.RunSQL strSQL
        End If
        
        DoCmd.SetWarnings (True)
        
        DoCmd.Close acForm, "frmCustomMSG", acSaveNo
        
        DoCmd.Close
                
        DoCmd.OpenForm "whatNext", , , , , , strTable & "|" & uprnCount
        
        statusmsg = SysCmd(acSysCmdSetStatus, "Select the option to carry out next.")
End If

Exit Sub
ErrorHandler:
    DoCmd.Close acForm, "frmCustomMSG", acSaveNo
    MsgBox "An error occured -  error  " & Err.Number & ": " & Err.Description
End Sub

Public Sub ChangePTStatement(p_QueryName As String, p_sql As String)
'for changing pass-through's in this db
'dark11984 Access Forums
    Dim qdef As DAO.QueryDef
 
    Set qdef = CurrentDb.QueryDefs(p_QueryName)
    qdef.sql = p_sql
    qdef.Close
    Set qdef = Nothing
 
End Sub

Private Sub Form_Open(Cancel As Integer)
Dim RS As DAO.Recordset
Dim sql As String

If Not IsNull(Me.OpenArgs) Then
    strTable = Me.OpenArgs
End If

UPCIDsExisting = ""
UPCIDs = ""
       
DoCmd.Maximize

sql = "select MatchKeys from getMatchKeysColumnPresent"
       
Set RS = CurrentDb.OpenRecordset(sql)
Do While Not RS.EOF
   UPCIDsExisting = UPCIDsExisting & RS("MatchKeys") & ", "
   RS.MoveNext
Loop
RS.Close
Set RS = Nothing
sql = ""

sql = "select MatchKeys from getMatchKeysColumnNotPresent"

Set RS = CurrentDb.OpenRecordset(sql)
Do While Not RS.EOF
    UPCIDs = UPCIDs & RS("MatchKeys") & ", "
    RS.MoveNext
Loop
RS.Close
Set RS = Nothing

If UPCIDsExisting <> "" Then
    UPCIDsExisting = Left(UPCIDsExisting, Len(UPCIDsExisting) - 2)
End If

If UPCIDs <> "" Then
    UPCIDs = Left(UPCIDs, Len(UPCIDs) - 2)
End If

Me.List2.RowSourceType = "Value List"
Me.List0.RowSourceType = "Value List"

Me.List2.RowSource = UPCIDsExisting
Me.List0.RowSource = UPCIDs

End Sub

Private Sub Image5_Click()
statusmsg = SysCmd(acSysCmdRemoveMeter)

statusmsg = SysCmd(acSysCmdSetStatus, "Opening More Information, please wait...")

DoCmd.OpenForm "moreInformation"

If Me.Text7.Value = "create" Then

    Forms!moreInformation.infoText.Caption = "The list box on the left-hand side holds all possible UPCIDs that can be added to your selected table. The list box on the right-hand side shows all UPCIDs that are currently in the table or that will be added. To add UPCIDs from the left to the right simply click the UPCID you wish to move and click the add button. To remove a pre-existing UPCID or a UPCID that you have added simply select the UPCID and click remove. When you have selected all the UPCIDs you wish to add click the next button to continue." & vbNewLine & "For more deatils on the selected UPCID make sure it is selected and simply hover over the UPCID."

ElseIf Me.Text7.Value = "add" Then

    Forms!moreInformation.infoText.Caption = "The list box on the left-hand side holds all UPCIDs columns that have been added to the table but not been populated. The right-hand list box shows all the UPCIDs that will be populated. To add UPCIDs from the left to the right simply click the UPCID you wish to move and click the add button. To remove a UPCID that you have added simply select the UPCID and click remove. If Pointer needs to be updated then check the relevant box. When you have selected all the UPCIDs you wish to populate click the next button to continue." & vbNewLine & "For more deatils on the selected UPCID make sure it is selected and simply hover over the UPCID."

ElseIf Me.Text7.Value = "match" Then

    Forms!moreInformation.infoText.Caption = "The list box on the left-hand side holds all UPCIDs columns that have been populated with UPCIDs. The right-hand list box shows all the UPCIDs that will be macthed on to achieve a UPRN. To add UPCIDs from the left to the right simply click the UPCID you wish to move and click the add button. To remove a UPCID that you have added simply select the UPCID and click remove. When you have selected all the UPCIDs you wish to match on click the next button to continue. *Please note, you need to order the UPCIDs in the order that you wish them to be matched.*" & vbNewLine & "For more deatils on the selected UPCID make sure it is selected and simply hover over the UPCID."

End If

End Sub

Public Function Pause(NumberOfSeconds As Variant)
On Error GoTo Err_Pause

    Dim PauseTime As Variant, start As Variant

    PauseTime = NumberOfSeconds
    start = Timer
    Do While Timer < start + PauseTime
    DoEvents
    Loop

Exit_Pause:
    Exit Function

Err_Pause:
    MsgBox Err.Number & " - " & Err.Description
    Resume Exit_Pause

End Function

Private Sub List0_Click()
With Me.List0
.ControlTipText = .Value & " = " & DLookup("Description", "matchKeys", "MatchKeys = '" & .Value & "'")
End With
End Sub

Private Sub List2_Click()
With Me.List2
.ControlTipText = .Value & " = " & DLookup("Description", "matchKeys", "MatchKeys = '" & .Value & "'")
End With
End Sub
