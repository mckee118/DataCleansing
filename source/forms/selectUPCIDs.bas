Version =20
VersionRequired =20
PublishOption =1
    PopUp = NotDefault
    Modal = NotDefault
    RecordSelectors = NotDefault
    NavigationButtons = NotDefault
    DividingLines = NotDefault
    AllowDesignChanges = NotDefault
    DefaultView =0
    PictureAlignment =2
    DatasheetGridlinesBehavior =3
    GridY =10
    Width =8674
    DatasheetFontHeight =11
    ItemSuffix =13
    Left =3720
    Top =2085
    Right =12645
    Bottom =8025
    DatasheetGridlinesColor =14806254
        0xa9f965aa9b59e440
    End
    OnOpen ="[Event Procedure]"
    DatasheetFontName ="Calibri"
        0x6801000068010000680100006801000000000000201c0000e010000001000000 ,
        0x010000006801000000000000a10700000100000001000000
    End
    AllowDatasheetView =0
    AllowPivotTableView =0
    AllowPivotChartView =0
    AllowPivotChartView =0
    FilterOnLoad =0
    ShowPageMargins =0
    DisplayOnSharePointSite =1
    DatasheetAlternateBackColor =15921906
    DatasheetGridlinesColor12 =0
    FitToScreen =1
    DatasheetBackThemeColorIndex =1
    BorderThemeColorIndex =3
    ThemeFontIndex =1
    ForeThemeColorIndex =0
    AlternateBackThemeColorIndex =1
    AlternateBackShade =95.0
            BackStyle =0
            FontSize =11
            FontName ="Calibri"
            ThemeFontIndex =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =0
            BorderTint =50.0
            ForeThemeColorIndex =0
            ForeTint =50.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
            Width =1701
            Height =283
            FontSize =11
            FontWeight =400
            FontName ="Calibri"
            ForeThemeColorIndex =0
            ForeTint =75.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
            UseTheme =1
            Shape =1
            Gradient =12
            BackThemeColorIndex =4
            BackTint =60.0
            BorderLineStyle =0
            BorderColor =16777215
            BorderThemeColorIndex =4
            BorderTint =60.0
            ThemeFontIndex =1
            HoverThemeColorIndex =4
            HoverTint =40.0
            PressedThemeColorIndex =4
            PressedShade =75.0
            HoverForeThemeColorIndex =0
            HoverForeTint =75.0
            PressedForeThemeColorIndex =0
            PressedForeTint =75.0
        End
            AddColon = NotDefault
            FELineBreak = NotDefault
            BorderLineStyle =0
            Width =1701
            LabelX =-1701
            FontSize =11
            FontName ="Calibri"
            AsianLineBreak =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =1
            BorderShade =65.0
            ThemeFontIndex =1
            ForeThemeColorIndex =0
            ForeTint =75.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
            BorderLineStyle =0
            Width =1701
            Height =1417
            LabelX =-1701
            FontSize =11
            FontName ="Calibri"
            AllowValueListEdits =1
            InheritValueList =1
            ThemeFontIndex =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =1
            BorderShade =65.0
            ForeThemeColorIndex =0
            ForeTint =75.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
            Height =5952
            Name ="Detail"
            AutoHeight =1
            AlternateBackColor =15921906
            AlternateBackThemeColorIndex =1
            AlternateBackShade =95.0
            BackThemeColorIndex =1
                    RowSourceTypeInt =1
                    OverlapFlags =87
                    IMESentenceMode =3
                    Left =396
                    Top =737
                    Width =3005
                    Height =4365
                    ForeColor =4210752
                    BorderColor =10921638
                    Name ="List0"
                    RowSourceType ="Value List"
                    GridlineColor =10921638
                    AllowValueListEdits =0

                    LayoutCachedLeft =396
                    LayoutCachedTop =737
                    LayoutCachedWidth =3401
                    LayoutCachedHeight =5102
                End
                    RowSourceTypeInt =1
                    OverlapFlags =87
                    IMESentenceMode =3
                    Left =5331
                    Top =735
                    Width =2948
                    Height =4365
                    TabIndex =1
                    ForeColor =4210752
                    BorderColor =10921638
                    Name ="List2"
                    RowSourceType ="Value List"
                    GridlineColor =10921638
                    AllowValueListEdits =0

                    LayoutCachedLeft =5331
                    LayoutCachedTop =735
                    LayoutCachedWidth =8279
                    LayoutCachedHeight =5100
                End
                    OverlapFlags =85
                    Left =3968
                    Top =1757
                    Width =732
                    Height =510
                    TabIndex =2
                    ForeColor =4210752
                    Name ="Command4"
                    Caption ="Command4"
                    OnClick ="[Event Procedure]"
                    GridlineColor =10921638
                        0x2800000010000000100000000100200000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x00000000904820ff904820300000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x00000000a05020ffa05030ff9048203000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000d08060ff904820ffa04820ff ,
                        0xa05020ffb05830ffc06840ffa05030ff90482030000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000d08860ffffb090fff09060ff ,
                        0xf08850ffe08050ffd07850ffc07040ffa05830ff904820300000000000000000 ,
                        0x0000000000000000000000000000000000000000e09070ffffb890ffffa880ff ,
                        0xff9060fff09060ffe08850ffe07850ffc07040ffb05830ff0000000000000000 ,
                        0x0000000000000000000000000000000000000000e09870ffffc0a0ffffc0a0ff ,
                        0xffb080ffffa880ffffa070ffe08050ffb05830ffb05830200000000000000000 ,
                        0x0000000000000000000000000000000000000000f0a070ffe09870ffe09070ff ,
                        0xd08860ffe09070fff09870ffb05830ffb0583020000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x00000000e09870ffc07850ffb058302000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x00000000f0a070ffd08060200000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000
                    End

                    LayoutCachedLeft =3968
                    LayoutCachedTop =1757
                    LayoutCachedWidth =4700
                    LayoutCachedHeight =2267
                    BackColor =14136213
                    BorderColor =14136213
                    HoverColor =15060409
                    PressedColor =9592887
                    HoverForeColor =4210752
                    PressedForeColor =4210752
                    WebImagePaddingLeft =2
                    WebImagePaddingTop =2
                    WebImagePaddingRight =1
                    WebImagePaddingBottom =1
                End
                    OverlapFlags =85
                    Left =3968
                    Top =2387
                    Width =732
                    Height =510
                    TabIndex =3
                    ForeColor =4210752
                    Name ="Command5"
                    Caption ="Command4"
                    OnClick ="[Event Procedure]"
                    GridlineColor =10921638
                        0x2800000010000000100000000100200000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000000000000000000020202030000800900000004000080010 ,
                        0x0000000000000000000000000000000000000000000000000000000000000010 ,
                        0x0000000000000000000000001010100010181080101010ff202020c010081020 ,
                        0x1010100000000000000000000000000000000000101010004038309010101030 ,
                        0x3030200000000000000000000000000020202050201810ff302820ff30282080 ,
                        0x100810100000000000000000000000000008000030282020202820e010101020 ,
                        0x3030200000000000000000000000000040303010202020a0201820f0303030e0 ,
                        0x3030303000000000000000001010101010081010303030d02020209020202000 ,
                        0x000000000000000000000000000000000000000030283020202020d0202020ff ,
                        0x303030c020182010101010101010101020202090303030f03028202000000000 ,
                        0x00000000000000000000000000000000000000000000000030303020302820d0 ,
                        0x302820ff302830b020181030202020b0303030ff302820700000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000030383020 ,
                        0x302820d0303030ff303030ff403830ff302830e0000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x30303040303030ff403840ff303030e030202010000000000000000000000000 ,
                        0x0000000000000000000000000000000000000000000000004040400040404030 ,
                        0x404040d0403830ff303030f0303030f0302820b0302820100000000000000000 ,
                        0x00000000000000000000000000000000000000004040400040404070404040ff ,
                        0x404040ff505050a04038403040384090404040ff303030903028201000000000 ,
                        0x0000000000000000000000004040402040404040404040b0404040ff404040ff ,
                        0x505050b0505050100000000040383010504840b0404040ff3038309030303010 ,
                        0x00000000000000004040400040404060404040b0403830ff404040ff50485080 ,
                        0x504850000000000000000000000000003028201040404040504850f0404040a0 ,
                        0x00000000000000004040400040484060404040ff404040f05048505050505000 ,
                        0x0000000000000000000000000000000000000000404040005050502040484070 ,
                        0x00000000000000000000000050485030504850c0504850405048500000000000 ,
                        0x0000000000000000000000000000000000000000000000000000000000000000 ,
                        0x0000000000000000
                    End

                    LayoutCachedLeft =3968
                    LayoutCachedTop =2387
                    LayoutCachedWidth =4700
                    LayoutCachedHeight =2897
                    BackColor =14136213
                    BorderColor =14136213
                    HoverColor =15060409
                    PressedColor =9592887
                    HoverForeColor =4210752
                    PressedForeColor =4210752
                    WebImagePaddingLeft =2
                    WebImagePaddingTop =2
                    WebImagePaddingRight =1
                    WebImagePaddingBottom =1
                End
                    OverlapFlags =85
                    Left =3685
                    Top =3514
                    Width =1303
                    Height =559
                    TabIndex =4
                    ForeColor =4210752
                    Name ="Command6"
                    Caption ="Confirm Selection"
                    OnClick ="[Event Procedure]"
                    GridlineColor =10921638

                    LayoutCachedLeft =3685
                    LayoutCachedTop =3514
                    LayoutCachedWidth =4988
                    LayoutCachedHeight =4073
                    BackColor =14136213
                    BorderColor =14136213
                    HoverColor =15060409
                    PressedColor =9592887
                    HoverForeColor =4210752
                    PressedForeColor =4210752
                    WebImagePaddingLeft =2
                    WebImagePaddingTop =2
                    WebImagePaddingRight =1
                    WebImagePaddingBottom =1
                End
                    Visible = NotDefault
                    OverlapFlags =85
                    IMESentenceMode =3
                    Top =5272
                    Height =315
                    TabIndex =5
                    BorderColor =10921638
                    ForeColor =4210752
                    Name ="Text7"
                    GridlineColor =10921638

                    LayoutCachedTop =5272
                    LayoutCachedWidth =1701
                    LayoutCachedHeight =5587
                End
                    OldBorderStyle =0
                    OverlapFlags =93
                    TextAlign =2
                    IMESentenceMode =3
                    Left =390
                    Width =7887
                    Height =735
                    FontSize =14
                    FontWeight =600
                    TabIndex =6
                    BorderColor =10921638
                    ForeColor =4210752
                    Name ="Text11"
                    GridlineColor =10921638

                    LayoutCachedLeft =390
                    LayoutCachedWidth =8277
                    LayoutCachedHeight =735
                End
            End
        End
    End
End
CodeBehindForm
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Compare Database
Public UPCIDsExisting As String
Public UPCIDs As String

Private Sub Command4_Click()

For i = 0 To List0.ListCount - 1
    If List0.Selected(i) Then
        List2.AddItem List0.Column(0)
        List0.RemoveItem List0.Column(0)
    End If
Next i

Me.List0.Selected(0) = True

End Sub

Private Sub Command5_Click()

For i = 0 To List2.ListCount - 1
    If List2.Selected(i) Then
        List0.AddItem List2.Column(0)
        List2.RemoveItem List2.Column(0)
    End If
Next i

Me.List2.Selected(0) = True

End Sub

Private Sub Command6_Click()

Dim strSQL As String
Dim strTable As String
Dim UPCIDsSplit() As String
Dim ListBoxUPCIDs() As String
Dim UnwantedListBoxUPCIDs() As String
Dim hasUPRN As String

strTable = Forms!FrontPage!Combo8.Value

UPCIDsSplit() = Split(UPCIDsExisting, ", ")

ListBoxUPCIDs() = Split(Replace(List2.RowSource, ";", ", "), ", ")

UnwantedListBoxUPCIDs() = Split(Replace(List0.RowSource, ";", ", "), ", ")

strSQL = "SELECT COLUMN_NAME FROM [INFORMATION_SCHEMA].COLUMNS WHERE COLUMN_NAME = 'uprn' AND TABLE_NAME = '" & strTable & "'"

ChangePTStatement "getUPRNColumn", strSQL

strSQL = ""

hasUPRN = Nz(DLookup("COLUMN_NAME", "getUPRNColumn"), "none")

Dim i As Long
Dim j As Long
Dim wanted As String
Dim unwanted As String

unwanted = ""

If Text7.Value = "create" Then
    For i = LBound(ListBoxUPCIDs) To UBound(ListBoxUPCIDs)
        For j = LBound(UPCIDsSplit) To UBound(UPCIDsSplit)
            If ListBoxUPCIDs(i) = UPCIDsSplit(j) Then
                ListBoxUPCIDs(i) = "@"
            End If
        Next j
    Next i

    For i = LBound(UnwantedListBoxUPCIDs) To UBound(UnwantedListBoxUPCIDs)
        For j = LBound(UPCIDsSplit) To UBound(UPCIDsSplit)
            If UnwantedListBoxUPCIDs(i) = UPCIDsSplit(j) Then
               unwanted = unwanted & UnwantedListBoxUPCIDs(i) & ", "
            End If
        Next j
    Next i
    

    wanted = Join(ListBoxUPCIDs, ", ")
    
    wanted = Replace(wanted, "@, ", "")
    
    wanted = Replace(wanted, "@", "")
    
    If unwanted <> "" Then
        unwanted = Left(unwanted, Len(unwanted) - 2)
        strSQL = "ALTER TABLE "
        strSQL = strSQL & strTable
        strSQL = strSQL & " DROP COLUMN " & unwanted
             
        ChangePTStatement "deleteUPCIDsAddress", strSQL
       
        DoCmd.SetWarnings (False)
        DoCmd.OpenQuery ("deleteUPCIDsAddress")
        MsgBox "UPCID(s) Deleted.", vbOKOnly, "Complete!"
        DoCmd.SetWarnings (True)
    End If

    List2.RowSource = ""

    Dim sqlUPCIDs As String
    sqlUPCIDs = Replace(wanted, ", ", " varchar(128), ")
    If wanted <> "" Then
         sqlUPCIDs = sqlUPCIDs & " varchar(128)"
    End If
       
    If wanted <> "" Then
       If hasUPRN = "none" Then
          strSQL = "ALTER TABLE "
          strSQL = strSQL & strTable
          strSQL = strSQL & " ADD " & sqlUPCIDs & ", UPRN varchar(128)"
             
          ChangePTStatement "createUPCIDsAddress", strSQL
       
          DoCmd.SetWarnings (False)
          DoCmd.OpenQuery ("createUPCIDsAddress")
          MsgBox "UPCID(s) Created and UPRN column also added.", vbOKOnly, "Complete!"
          DoCmd.SetWarnings (True)
       Else
          strSQL = "ALTER TABLE "
          strSQL = strSQL & strTable
          strSQL = strSQL & " ADD " & sqlUPCIDs
          
          ChangePTStatement "createUPCIDsAddress", strSQL
       
          DoCmd.SetWarnings (False)
          DoCmd.OpenQuery ("createUPCIDsAddress")
          MsgBox "UPCID(s) Created", vbOKOnly, "Complete!"
          DoCmd.SetWarnings (True)
                          
       End If
              
       'If IsNull(DLookup("table", "UPCIDs", "table = '" & strTable & "'")) = True Then
       '   strSQL = "INSERT INTO UPCIDs ([table]) VALUES ('" & strTable & "')"
       '   DoCmd.SetWarnings (False)
       '   DoCmd.RunSQL strSQL
       '   DoCmd.SetWarnings (True)
       'End If
    End If
    'added more UPCID's
      
ElseIf Text7.Value = "add" Then
       Dim caseStates() As String
       Dim forSQL As String
       caseStates = Split(Replace(List2.RowSource, ";", ", "), ", ")
       
       forSQL = Replace(List2.RowSource, ";", ", ")
       
       Dim sqlDefault As String
       Dim sqlstr As String
            
       sqlDefault = "Update " & strTable & " set"
       sqlstr = ""
       
       For i = LBound(caseStates) To UBound(caseStates)
            Select Case caseStates(i)
            
            Case "UPCID_N_WP"
                sqlstr = sqlstr & sqlDefault & " upcid_n_wp = REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'numbers') + ISNULL(POSTCODE, ''), ' ', '')"
            Case "UPCID_N_NP"
                sqlstr = sqlstr & sqlDefault & " upcid_n_np = REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, '')+ISNULL(POSTCODE, ''), 'numbers'), ' ', '')"
            Case "UPCID_WS_WP"
                sqlstr = sqlstr & sqlDefault & " upcid_ws_wp = dbo.unwanted(REPLACE(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, '')+ISNULL(POSTCODE, ''), ' ', ''))"
            Case "UPCID_WS_NP"
                sqlstr = sqlstr & sqlDefault & " upcid_ws_np = dbo.unwanted(REPLACE(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, '')+DBO.fn_extract_chars(ISNULL(POSTCODE, ''), 'numbers'), ' ', ''))"
            Case "UPCID_CS_WP"
                sqlstr = sqlstr & sqlDefault & " upcid_cs_wp = dbo.unwanted(REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'letters') + ISNULL(POSTCODE, ''), ' ', ''))"
            Case "UPCID_CS_NP"
                sqlstr = sqlstr & sqlDefault & " upcid_cs_np = dbo.unwanted(REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'letters')+DBO.fn_extract_chars(ISNULL(POSTCODE, ''), 'numbers'), ' ', ''))"
            Case "UPCID_N_NVD_WP"
                sqlstr = sqlstr & sqlDefault & " upcid_n_nvd_wp = dbo.unwanted(REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'numbers')+DBO.nvd(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, '')) +ISNULL(POSTCODE, ''), ' ', ''))"
            Case "UPCID_N_NVD_NP"
                sqlstr = sqlstr & sqlDefault & " upcid_n_nvd_np = dbo.unwanted(REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'numbers')+DBO.nvd(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, '')) +DBO.fn_extract_chars(ISNULL(POSTCODE, ''), 'numbers'), ' ', ''))"
            Case "UPCID_NVD_WP"
                sqlstr = sqlstr & sqlDefault & " upcid_nvd_wp = dbo.unwanted(REPLACE(DBO.nvd(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, '')) +ISNULL(POSTCODE, ''), ' ', ''))"
            Case "UPCID_NVD_NP"
                sqlstr = sqlstr & sqlDefault & " upcid_nvd_np = dbo.unwanted(REPLACE(DBO.nvd(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, '')) +POINTER.DBO.fn_extract_chars(ISNULL(POSTCODE, ''), 'numbers'), ' ', ''))"
            Case "UPCID_N_FC_WP"
                sqlstr = sqlstr & sqlDefault & " upcid_n_fc_wp = dbo.unwanted(REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'numbers')+LEFT(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'letters'), 1)+ISNULL(POSTCODE, ''), ' ', ''))"
            Case "UPCID_N_FC_NP"
                sqlstr = sqlstr & sqlDefault & " upcid_n_fc_np = dbo.unwanted(REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'numbers')+LEFT(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'letters'), 1)+DBO.fn_extract_chars(ISNULL(POSTCODE, ''), 'numbers'), ' ', ''))"
            Case "UPCID_N_3C_WP"
                sqlstr = sqlstr & sqlDefault & " upcid_n_3c_wp = dbo.unwanted(REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'numbers')+LEFT(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'letters'), 3)+ISNULL(POSTCODE, ''), ' ', ''))"
            Case "UPCID_N_3C_NP"
                sqlstr = sqlstr & sqlDefault & " upcid_n_3c_np = dbo.unwanted(REPLACE(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'numbers')+LEFT(DBO.fn_extract_chars(ISNULL(Address1, '')+ISNULL(Address2, '')+ISNULL(Address3, '')+ISNULL(Address4, ''), 'letters'), 3)+DBO.fn_extract_chars(ISNULL(POSTCODE, ''), 'numbers'), ' ', ''))"
            End Select
       Next i
              
       strSQL = sqlstr
       'strSQL = Left(strSQL, Len(strSQL) - 2)
             
       'call the pass through function
       ChangePTStatement "addUPCIDsAddress", strSQL
       
       
       If IsNull(DLookup("table", "UPCIDs", "table = '" & strTable & "'")) = True Then
          strSQL = "INSERT INTO UPCIDs ([table], UPCIDs) VALUES ('" & strTable & "', '" & forSQL & "')"
          DoCmd.SetWarnings (False)
          DoCmd.RunSQL strSQL
          DoCmd.SetWarnings (True)
       Else
          DoCmd.SetWarnings (False)
          strSQL = "DELETE FROM UPCIDs WHERE [table] = '" & strTable & "'"
          DoCmd.RunSQL strSQL
          strSQL = "INSERT INTO UPCIDs ([table], UPCIDs) VALUES ('" & strTable & "', '" & forSQL & "')"
          DoCmd.RunSQL strSQL
          DoCmd.SetWarnings (True)
       End If
       
        DoCmd.SetWarnings (False)
        DoCmd.OpenQuery ("addUPCIDsAddress")
        MsgBox "UPCIDs Added", vbOKOnly, "Complete"
        DoCmd.SetWarnings (True)

ElseIf Text7.Value = "match" Then
    MsgBox List2.RowSource
    caseStates = Split(Replace(List2.RowSource, ";", ", "), ", ")
                
    sqlstr = ""
    
    For i = LBound(caseStates) To UBound(caseStates)
    
            sqlstr = sqlstr & "select a." & caseStates(i) & " as add" & caseStates(i) & ", p." & caseStates(i) & " as P" & caseStates(i) & ", p.UPRN" & _
            " into tempPointer" & _
            " from " & strTable & " a" & _
            " inner join POINTER p" & _
            " on a." & caseStates(i) & " = p." & caseStates(i) & _
            vbNewLine & _
            "select add" & caseStates(i) & ", COUNT(*) as counter" & _
            " into tempAddress" & _
            " from tempPointer" & _
            " group by add" & caseStates(i) & _
            " having COUNT(*) >= 1" & _
            vbNewLine & _
            "Update main" & _
            " Set main.uprn = tp.uprn" & _
            " from " & strTable & " main" & _
            " inner join tempPointer tp" & _
            " on main." & caseStates(i) & " = tp.P" & caseStates(i) & _
            " inner join tempAddress ta" & _
            " on main." & caseStates(i) & " = ta.add" & caseStates(i) & _
            " where main.uprn Is Null and len(" & caseStates(i) & ") > 1" & _
            vbNewLine & _
            "drop table tempPointer" & _
            vbNewLine & _
            "drop table tempAddress" & _
            vbNewLine
            
       Next i
       
       strSQL = sqlstr
             
       'call the pass through function
       ChangePTStatement "addUPRN", strSQL
       
        DoCmd.SetWarnings (False)
        DoCmd.OpenQuery ("addUPRN")
        MsgBox "UPRNs Added", vbOKOnly, "Complete"
        DoCmd.SetWarnings (True)
       
End If

Forms!FrontPage!Command4.Enabled = True
DoCmd.Close
End Sub

Public Sub ChangePTStatement(p_QueryName As String, p_sql As String)
'for changing pass-through's in this db
    Dim qdef As DAO.QueryDef
 
    Set qdef = CurrentDb.QueryDefs(p_QueryName)
    qdef.sql = p_sql
    qdef.Close
    Set qdef = Nothing
 
End Sub

Private Sub Form_Open(Cancel As Integer)
Dim RS As DAO.Recordset
Dim sql As String

UPCIDsExisting = ""
UPCIDs = ""
       
sql = "select MatchKeys from getMatchKeysColumnPresent"
       
Set RS = CurrentDb.OpenRecordset(sql)
Do While Not RS.EOF
   UPCIDsExisting = UPCIDsExisting & RS("MatchKeys") & ", "
   RS.MoveNext
Loop
RS.Close
Set RS = Nothing
sql = ""

sql = "select MatchKeys from getMatchKeysColumnNotPresent"

Set RS = CurrentDb.OpenRecordset(sql)
Do While Not RS.EOF
    UPCIDs = UPCIDs & RS("MatchKeys") & ", "
    RS.MoveNext
Loop
RS.Close
Set RS = Nothing

If UPCIDsExisting <> "" Then
    UPCIDsExisting = Left(UPCIDsExisting, Len(UPCIDsExisting) - 2)
End If

If UPCIDs <> "" Then
    UPCIDs = Left(UPCIDs, Len(UPCIDs) - 2)
End If

Me.List2.RowSourceType = "Value List"
Me.List0.RowSourceType = "Value List"

Me.List2.RowSource = UPCIDsExisting
Me.List0.RowSource = UPCIDs

'Me.List0.RowSource = UPCIDsExisting
'Me.List2.RowSource = ""

End Sub
